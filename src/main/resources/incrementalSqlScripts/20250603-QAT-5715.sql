UPDATE rm_program p SET p.PROGRAM_CODE='NGA-LAB[GeneXpert]-MOH-OLD', p.ACTIVE=0 where p.PROGRAM_ID=2356;
INSERT INTO ap_label VALUES (null, 'Nigeria Lab [EID POC]', null, null, null, 1,now(), 1,now(), 18);	INSERT INTO rm_program SELECT null, 'NGA-LAB [EID POC]-MOH', p.REALM_ID, p.REALM_COUNTRY_ID, p.ORGANISATION_ID, last_insert_id(), p.PROGRAM_MANAGER_USER_ID, p.PROGRAM_NOTES, p.AIR_FREIGHT_PERC,p.SEA_FREIGHT_PERC, p.ROAD_FREIGHT_PERC, p.PLANNED_TO_SUBMITTED_LEAD_TIME, p.SUBMITTED_TO_APPROVED_LEAD_TIME,	p.APPROVED_TO_SHIPPED_LEAD_TIME,p.SHIPPED_TO_ARRIVED_BY_AIR_LEAD_TIME, p.SHIPPED_TO_ARRIVED_BY_SEA_LEAD_TIME, p.SHIPPED_TO_ARRIVED_BY_ROAD_LEAD_TIME, p.ARRIVED_TO_DELIVERED_LEAD_TIME, p.NO_OF_MONTHS_IN_PAST_FOR_BOTTOM_DASHBOARD,	 p.NO_OF_MONTHS_IN_FUTURE_FOR_BOTTOM_DASHBOARD, p.CURRENT_VERSION_ID, 1, 1, now(), 1, now(), p.PROGRAM_TYPE_ID FROM rm_program p where p.PROGRAM_ID=2356;	SET @programId1=last_insert_id();	INSERT INTO rm_program_health_area VALUES (null,@programId1, 5);	INSERT INTO rm_program_region VALUES (null, @programId1, 59, 1, 1, now(), 1, now());
INSERT INTO ap_label VALUES (null, 'Nigeria TB [GeneXpert]', null, null, null, 1,now(), 1,now(), 18);	INSERT INTO rm_program SELECT null, 'NGA-TB [GeneXpert]-MOH', p.REALM_ID, p.REALM_COUNTRY_ID, p.ORGANISATION_ID, last_insert_id(), p.PROGRAM_MANAGER_USER_ID, p.PROGRAM_NOTES, p.AIR_FREIGHT_PERC,p.SEA_FREIGHT_PERC, p.ROAD_FREIGHT_PERC, p.PLANNED_TO_SUBMITTED_LEAD_TIME, p.SUBMITTED_TO_APPROVED_LEAD_TIME,	p.APPROVED_TO_SHIPPED_LEAD_TIME,p.SHIPPED_TO_ARRIVED_BY_AIR_LEAD_TIME, p.SHIPPED_TO_ARRIVED_BY_SEA_LEAD_TIME, p.SHIPPED_TO_ARRIVED_BY_ROAD_LEAD_TIME, p.ARRIVED_TO_DELIVERED_LEAD_TIME, p.NO_OF_MONTHS_IN_PAST_FOR_BOTTOM_DASHBOARD,	 p.NO_OF_MONTHS_IN_FUTURE_FOR_BOTTOM_DASHBOARD, p.CURRENT_VERSION_ID, 1, 1, now(), 1, now(), p.PROGRAM_TYPE_ID FROM rm_program p where p.PROGRAM_ID=2356;	SET @programId2=last_insert_id();	INSERT INTO rm_program_health_area VALUES (null,@programId2, 5);	INSERT INTO rm_program_region VALUES (null, @programId2, 59, 1, 1, now(), 1, now());

SET @oldProgramId=2356;	

UPDATE rm_budget_program bp SET bp.PROGRAM_ID=@programId1 WHERE bp.PROGRAM_ID=@oldProgramId;
INSERT INTO rm_budget_program SELECT null, BUDGET_ID, @programId2 FROM rm_budget_program bp WHERE bp.PROGRAM_ID=@programId1;
	SELECT BUDGET_ID into @budgetId1 FROM rm_budget_program pb WHERE pb.PROGRAM_ID=@programId1;
	SELECT BUDGET_ID into @budgetId2 FROM rm_budget_program pb WHERE pb.PROGRAM_ID=@programId2;

UPDATE rm_program_planning_unit ppu SET ppu.PROGRAM_ID=@programId1 WHERE ppu.PROGRAM_ID=2356 AND ppu.PLANNING_UNIT_ID=2760;	UPDATE rm_supply_plan_amc sma SET sma.PROGRAM_ID=@programId1 WHERE sma.PROGRAM_ID=2356 AND sma.PLANNING_UNIT_ID=2760;	UPDATE rm_supply_plan_batch_qty spbq SET spbq.PROGRAM_ID=@programId1 WHERE spbq.PROGRAM_ID=2356 AND spbq.PLANNING_UNIT_ID=2760;	UPDATE rm_batch_info bi SET bi.PROGRAM_ID=@programId1 WHERE bi.PROGRAM_ID=2356 AND bi.PLANNING_UNIT_ID=2760;	UPDATE rm_shipment s LEFT JOIN rm_shipment_trans st ON s.SHIPMENT_ID=st.SHIPMENT_ID SET s.PROGRAM_ID=@programId1, st.BUDGET_ID=@budgetId1  WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=2760;	UPDATE rm_consumption s LEFT JOIN rm_consumption_trans st ON s.CONSUMPTION_ID=st.CONSUMPTION_ID SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=2760;	UPDATE rm_inventory s LEFT JOIN rm_inventory_trans st ON s.INVENTORY_ID=st.INVENTORY_ID LEFT JOIN rm_realm_country_planning_unit rcpu ON st.REALM_COUNTRY_PLANNING_UNIT_ID=rcpu.REALM_COUNTRY_PLANNING_UNIT_ID SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND rcpu.PLANNING_UNIT_ID=2760;	UPDATE rm_problem_report s SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND s.DATA3=2760;	UPDATE rm_realm_country_planning_unit rcpu SET rcpu.SKU_CODE=CONCAT(@programId1, RIGHT(rcpu.SKU_CODE,LENGTH(rcpu.SKU_CODE)-4)) WHERE rcpu.REALM_COUNTRY_ID=26 AND rcpu.SKU_CODE LIKE CONCAT(@oldProgramId,'%') AND rcpu.PLANNING_UNIT_ID=2760;
UPDATE rm_program_planning_unit ppu SET ppu.PROGRAM_ID=@programId1 WHERE ppu.PROGRAM_ID=2356 AND ppu.PLANNING_UNIT_ID=3308;	UPDATE rm_supply_plan_amc sma SET sma.PROGRAM_ID=@programId1 WHERE sma.PROGRAM_ID=2356 AND sma.PLANNING_UNIT_ID=3308;	UPDATE rm_supply_plan_batch_qty spbq SET spbq.PROGRAM_ID=@programId1 WHERE spbq.PROGRAM_ID=2356 AND spbq.PLANNING_UNIT_ID=3308;	UPDATE rm_batch_info bi SET bi.PROGRAM_ID=@programId1 WHERE bi.PROGRAM_ID=2356 AND bi.PLANNING_UNIT_ID=3308;	UPDATE rm_shipment s LEFT JOIN rm_shipment_trans st ON s.SHIPMENT_ID=st.SHIPMENT_ID SET s.PROGRAM_ID=@programId1, st.BUDGET_ID=@budgetId1  WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=3308;	UPDATE rm_consumption s LEFT JOIN rm_consumption_trans st ON s.CONSUMPTION_ID=st.CONSUMPTION_ID SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=3308;	UPDATE rm_inventory s LEFT JOIN rm_inventory_trans st ON s.INVENTORY_ID=st.INVENTORY_ID LEFT JOIN rm_realm_country_planning_unit rcpu ON st.REALM_COUNTRY_PLANNING_UNIT_ID=rcpu.REALM_COUNTRY_PLANNING_UNIT_ID SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND rcpu.PLANNING_UNIT_ID=3308;	UPDATE rm_problem_report s SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND s.DATA3=3308;	UPDATE rm_realm_country_planning_unit rcpu SET rcpu.SKU_CODE=CONCAT(@programId1, RIGHT(rcpu.SKU_CODE,LENGTH(rcpu.SKU_CODE)-4)) WHERE rcpu.REALM_COUNTRY_ID=26 AND rcpu.SKU_CODE LIKE CONCAT(@oldProgramId,'%') AND rcpu.PLANNING_UNIT_ID=3308;
UPDATE rm_program_planning_unit ppu SET ppu.PROGRAM_ID=@programId1 WHERE ppu.PROGRAM_ID=2356 AND ppu.PLANNING_UNIT_ID=6211;	UPDATE rm_supply_plan_amc sma SET sma.PROGRAM_ID=@programId1 WHERE sma.PROGRAM_ID=2356 AND sma.PLANNING_UNIT_ID=6211;	UPDATE rm_supply_plan_batch_qty spbq SET spbq.PROGRAM_ID=@programId1 WHERE spbq.PROGRAM_ID=2356 AND spbq.PLANNING_UNIT_ID=6211;	UPDATE rm_batch_info bi SET bi.PROGRAM_ID=@programId1 WHERE bi.PROGRAM_ID=2356 AND bi.PLANNING_UNIT_ID=6211;	UPDATE rm_shipment s LEFT JOIN rm_shipment_trans st ON s.SHIPMENT_ID=st.SHIPMENT_ID SET s.PROGRAM_ID=@programId1, st.BUDGET_ID=@budgetId1  WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=6211;	UPDATE rm_consumption s LEFT JOIN rm_consumption_trans st ON s.CONSUMPTION_ID=st.CONSUMPTION_ID SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=6211;	UPDATE rm_inventory s LEFT JOIN rm_inventory_trans st ON s.INVENTORY_ID=st.INVENTORY_ID LEFT JOIN rm_realm_country_planning_unit rcpu ON st.REALM_COUNTRY_PLANNING_UNIT_ID=rcpu.REALM_COUNTRY_PLANNING_UNIT_ID SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND rcpu.PLANNING_UNIT_ID=6211;	UPDATE rm_problem_report s SET s.PROGRAM_ID=@programId1 WHERE s.PROGRAM_ID=2356 AND s.DATA3=6211;	UPDATE rm_realm_country_planning_unit rcpu SET rcpu.SKU_CODE=CONCAT(@programId1, RIGHT(rcpu.SKU_CODE,LENGTH(rcpu.SKU_CODE)-4)) WHERE rcpu.REALM_COUNTRY_ID=26 AND rcpu.SKU_CODE LIKE CONCAT(@oldProgramId,'%') AND rcpu.PLANNING_UNIT_ID=6211;
UPDATE rm_program_planning_unit ppu SET ppu.PROGRAM_ID=@programId2 WHERE ppu.PROGRAM_ID=2356 AND ppu.PLANNING_UNIT_ID=3313;	UPDATE rm_supply_plan_amc sma SET sma.PROGRAM_ID=@programId2 WHERE sma.PROGRAM_ID=2356 AND sma.PLANNING_UNIT_ID=3313;	UPDATE rm_supply_plan_batch_qty spbq SET spbq.PROGRAM_ID=@programId2 WHERE spbq.PROGRAM_ID=2356 AND spbq.PLANNING_UNIT_ID=3313;	UPDATE rm_batch_info bi SET bi.PROGRAM_ID=@programId2 WHERE bi.PROGRAM_ID=2356 AND bi.PLANNING_UNIT_ID=3313;	UPDATE rm_shipment s LEFT JOIN rm_shipment_trans st ON s.SHIPMENT_ID=st.SHIPMENT_ID SET s.PROGRAM_ID=@programId2, st.BUDGET_ID=@budgetId2  WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=3313;	UPDATE rm_consumption s LEFT JOIN rm_consumption_trans st ON s.CONSUMPTION_ID=st.CONSUMPTION_ID SET s.PROGRAM_ID=@programId2 WHERE s.PROGRAM_ID=2356 AND st.PLANNING_UNIT_ID=3313;	UPDATE rm_inventory s LEFT JOIN rm_inventory_trans st ON s.INVENTORY_ID=st.INVENTORY_ID LEFT JOIN rm_realm_country_planning_unit rcpu ON st.REALM_COUNTRY_PLANNING_UNIT_ID=rcpu.REALM_COUNTRY_PLANNING_UNIT_ID SET s.PROGRAM_ID=@programId2 WHERE s.PROGRAM_ID=2356 AND rcpu.PLANNING_UNIT_ID=3313;	UPDATE rm_problem_report s SET s.PROGRAM_ID=@programId2 WHERE s.PROGRAM_ID=2356 AND s.DATA3=3313;	UPDATE rm_realm_country_planning_unit rcpu SET rcpu.SKU_CODE=CONCAT(@programId2, RIGHT(rcpu.SKU_CODE,LENGTH(rcpu.SKU_CODE)-4)) WHERE rcpu.REALM_COUNTRY_ID=26 AND rcpu.SKU_CODE LIKE CONCAT(@oldProgramId,'%') AND rcpu.PLANNING_UNIT_ID=3313;

DROP TABLE IF EXISTS temp_program_version;	
CREATE TABLE temp_program_version (  PROGRAM_VERSION_ID int unsigned NOT NULL AUTO_INCREMENT,  OLD_PROGRAM_VERSION_ID int unsigned NOT NULL,  OLD_PROGRAM_ID int unsigned NOT NULL,  NEW_PROGRAM_ID int unsigned NOT NULL,  VERSION_ID int unsigned NOT NULL,  VERSION_TYPE_ID int unsigned NOT NULL,  VERSION_STATUS_ID int unsigned NOT NULL,  NOTES text CHARACTER SET utf8mb3 COLLATE utf8mb3_bin,  CREATED_BY int unsigned NOT NULL,  CREATED_DATE datetime NOT NULL,  LAST_MODIFIED_BY int unsigned NOT NULL,  LAST_MODIFIED_DATE datetime NOT NULL,  SENT_TO_ARTMIS tinyint unsigned NOT NULL COMMENT '1-This version is sent to ARTMIS \n0-Not sent',  FORECAST_START_DATE datetime DEFAULT NULL,  FORECAST_STOP_DATE datetime DEFAULT NULL,  DAYS_IN_MONTH int unsigned DEFAULT NULL,  FREIGHT_PERC decimal(12,2) DEFAULT NULL,  FORECAST_THRESHOLD_HIGH_PERC decimal(12,2) DEFAULT NULL,  FORECAST_THRESHOLD_LOW_PERC decimal(12,2) DEFAULT NULL,  PRIMARY KEY (PROGRAM_VERSION_ID)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8mb3_bin;

DELETE pvt.* FROM rm_program_version pv LEFT JOIN rm_program_version_trans pvt ON pv.PROGRAM_VERSION_ID=pvt.PROGRAM_VERSION_ID WHERE pv.PROGRAM_ID=@programId1;	DELETE pv.* FROM rm_program_version pv WHERE pv.PROGRAM_ID=@programId1;		INSERT INTO temp_program_version SELECT null, pv.PROGRAM_VERSION_ID, pv.PROGRAM_ID, @programId1, pv.VERSION_ID, pv.VERSION_TYPE_ID, pv.VERSION_STATUS_ID, pv.NOTES, pv.CREATED_BY, pv.CREATED_DATE,pv.LAST_MODIFIED_BY, pv.LAST_MODIFIED_DATE, pv.SENT_TO_ARTMIS, pv.FORECAST_START_DATE, pv.FORECAST_STOP_DATE, pv.DAYS_IN_MONTH, pv.FREIGHT_PERC,  pv.FORECAST_THRESHOLD_HIGH_PERC, pv.FORECAST_THRESHOLD_LOW_PERC FROM rm_program_version pv WHERE pv.PROGRAM_ID=2356;	insert into rm_program_version SELECT null, @programId1, tpv.VERSION_ID, tpv.VERSION_TYPE_ID, tpv.VERSION_STATUS_ID, tpv.NOTES, tpv.CREATED_BY, tpv.CREATED_DATE, tpv.LAST_MODIFIED_BY, tpv.LAST_MODIFIED_DATE, tpv.SENT_TO_ARTMIS, tpv.FORECAST_START_DATE, tpv.FORECAST_STOP_DATE,  tpv.DAYS_IN_MONTH,  tpv.FREIGHT_PERC,  tpv.FORECAST_THRESHOLD_HIGH_PERC, tpv.FORECAST_THRESHOLD_LOW_PERC, 1 FROM temp_program_version tpv where tpv.NEW_PROGRAM_ID=@programId1;	INSERT INTO rm_program_version_trans SELECT null, pv.PROGRAM_VERSION_ID, pvt.VERSION_TYPE_ID, pvt.VERSION_STATUS_ID, pvt.NOTES, pvt.LAST_MODIFIED_BY, pvt.LAST_MODIFIED_DATE FROM temp_program_version tpv LEFT JOIN rm_program_version_trans pvt ON tpv.OLD_PROGRAM_VERSION_ID=pvt.PROGRAM_VERSION_ID LEFT JOIN rm_program_version pv ON pv.PROGRAM_ID=@programId1 AND pv.VERSION_ID=tpv.VERSION_ID WHERE tpv.NEW_PROGRAM_ID=@programId1;	UPDATE rm_shipment s left join rm_shipment_trans st ON s.SHIPMENT_ID=st.SHIPMENT_ID  SET st.BUDGET_ID=@budgetId1 where s.PROGRAM_ID=@programId1;		INSERT INTO rm_integration_program SELECT null, ip.INTEGRATION_ID, @programId1, ip.VERSION_TYPE_ID, ip.VERSION_STATUS_ID, ip.ACTIVE, ip.CREATED_BY, ip.CREATED_DATE, ip.LAST_MODIFIED_BY, ip.LAST_MODIFIED_DATE FROM rm_integration_program ip WHERE ip.PROGRAM_ID=2356;	
DELETE pvt.* FROM rm_program_version pv LEFT JOIN rm_program_version_trans pvt ON pv.PROGRAM_VERSION_ID=pvt.PROGRAM_VERSION_ID WHERE pv.PROGRAM_ID=@programId2;	DELETE pv.* FROM rm_program_version pv WHERE pv.PROGRAM_ID=@programId2;		INSERT INTO temp_program_version SELECT null, pv.PROGRAM_VERSION_ID, pv.PROGRAM_ID, @programId2, pv.VERSION_ID, pv.VERSION_TYPE_ID, pv.VERSION_STATUS_ID, pv.NOTES, pv.CREATED_BY, pv.CREATED_DATE,pv.LAST_MODIFIED_BY, pv.LAST_MODIFIED_DATE, pv.SENT_TO_ARTMIS, pv.FORECAST_START_DATE, pv.FORECAST_STOP_DATE, pv.DAYS_IN_MONTH, pv.FREIGHT_PERC,  pv.FORECAST_THRESHOLD_HIGH_PERC, pv.FORECAST_THRESHOLD_LOW_PERC FROM rm_program_version pv WHERE pv.PROGRAM_ID=2356;	insert into rm_program_version SELECT null, @programId2, tpv.VERSION_ID, tpv.VERSION_TYPE_ID, tpv.VERSION_STATUS_ID, tpv.NOTES, tpv.CREATED_BY, tpv.CREATED_DATE, tpv.LAST_MODIFIED_BY, tpv.LAST_MODIFIED_DATE, tpv.SENT_TO_ARTMIS, tpv.FORECAST_START_DATE, tpv.FORECAST_STOP_DATE,  tpv.DAYS_IN_MONTH,  tpv.FREIGHT_PERC,  tpv.FORECAST_THRESHOLD_HIGH_PERC, tpv.FORECAST_THRESHOLD_LOW_PERC, 1 FROM temp_program_version tpv where tpv.NEW_PROGRAM_ID=@programId2;	INSERT INTO rm_program_version_trans SELECT null, pv.PROGRAM_VERSION_ID, pvt.VERSION_TYPE_ID, pvt.VERSION_STATUS_ID, pvt.NOTES, pvt.LAST_MODIFIED_BY, pvt.LAST_MODIFIED_DATE FROM temp_program_version tpv LEFT JOIN rm_program_version_trans pvt ON tpv.OLD_PROGRAM_VERSION_ID=pvt.PROGRAM_VERSION_ID LEFT JOIN rm_program_version pv ON pv.PROGRAM_ID=@programId2 AND pv.VERSION_ID=tpv.VERSION_ID WHERE tpv.NEW_PROGRAM_ID=@programId2;	UPDATE rm_shipment s left join rm_shipment_trans st ON s.SHIPMENT_ID=st.SHIPMENT_ID  SET st.BUDGET_ID=@budgetId2 where s.PROGRAM_ID=@programId2;		INSERT INTO rm_integration_program SELECT null, ip.INTEGRATION_ID, @programId2, ip.VERSION_TYPE_ID, ip.VERSION_STATUS_ID, ip.ACTIVE, ip.CREATED_BY, ip.CREATED_DATE, ip.LAST_MODIFIED_BY, ip.LAST_MODIFIED_DATE FROM rm_integration_program ip WHERE ip.PROGRAM_ID=2356;	
DROP TABLE IF EXISTS temp_program_version;
